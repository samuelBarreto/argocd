---
apiVersion: argoproj.io/v1alpha1
kind: AppProject
metadata:
  name: platform
  namespace: argocd
  labels:
    project: platform
    app.kubernetes.io/managed-by: argocd
spec:
  description: "Platform Engineering - Crossplane Infrastructure"
  
  # Repositories permitidos
  sourceRepos:
  - 'https://github.com/samuelBarreto/argocd.git'  # ALTERAR
  - 'https://github.com/samuelBarreto/governance.git'
  - 'https://github.com/samuelBarreto/environments.git'
  - 'https://github.com/samuelBarreto/crossplane-system.git'
  - 'https://github.com/samuelBarreto/platform-apis.git'
  - 'https://charts.crossplane.io/stable'
  
  # Destinos permitidos (clusters e namespaces)
  destinations:
  - namespace: '*'  # Permitir todos os namespaces
    server: 'https://kubernetes.default.svc'
  - namespace: 'crossplane-system'
    server: 'https://kubernetes.default.svc'
  - namespace: 'argocd'
    server: 'https://kubernetes.default.svc'
  - namespace: 'dev'
    server: 'https://kubernetes.default.svc'
  - namespace: 'prod'
    server: 'https://kubernetes.default.svc'
  - namespace: 'hlm'
    server: 'https://kubernetes.default.svc'
  
  # Recursos permitidos (Cluster-scoped)
  clusterResourceWhitelist:
  - group: '*'
    kind: '*'
  
  # Recursos permitidos (Namespace-scoped)
  namespaceResourceWhitelist:
  - group: '*'
    kind: '*'
  
  # Orphaned resources (recursos órfãos)
  orphanedResources:
    warn: true
  
  # Roles para acesso ao projeto
  roles:
  - name: platform-admin
    description: "Full access to platform resources"
    policies:
    - p, proj:platform:platform-admin, applications, *, platform/*, allow
    groups:
    - platform-team
  
  - name: platform-viewer
    description: "Read-only access to platform resources"
    policies:
    - p, proj:platform:platform-viewer, applications, get, platform/*, allow
    - p, proj:platform:platform-viewer, applications, list, platform/*, allow
    groups:
    - developers

